
org 100h

section .bss
        backBufferSeg resw 1


section .data


xPos dw 0

xVelocity dw 1

sprite  db 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF
        db 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF
        db 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF
        db 0xFF, 0xFF, 0xFF, 0xFF, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF
        db 0xFF, 0xFF, 0xFF, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0xFF, 0xFF, 0xFF, 0xFF
        db 0xFF, 0xFF, 0x0A, 0x0A, 0x0A, 0x0f, 0x0f, 0x0A, 0x0A, 0x0A, 0x0f, 0x0f, 0x0A, 0xFF, 0xFF, 0xFF
        db 0xFF, 0xFF, 0x0A, 0x0A, 0x0f, 0x0f, 0x00, 0x00, 0x0A, 0x0f, 0x0f, 0x00, 0x00, 0xFF, 0xFF, 0xFF
        db 0xFF, 0xFF, 0x0A, 0x0A, 0x0f, 0x0f, 0x00, 0x00, 0x0A, 0x0f, 0x0f, 0x00, 0x00, 0xFF, 0xFF, 0xFF
        db 0xFF, 0x0A, 0x0A, 0x0A, 0x0f, 0x0f, 0x0f, 0x0f, 0x0A, 0x0f, 0x0f, 0x0f, 0x0f, 0x0A, 0xFF, 0xFF
        db 0xFF, 0x0A, 0x0A, 0x0A, 0x0A, 0x0f, 0x0f, 0x0A, 0x0A, 0x0A, 0x0f, 0x0f, 0x0A, 0x0A, 0xFF, 0xFF
        db 0xFF, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0xFF, 0xFF
        db 0xFF, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0xFF, 0xFF
        db 0xFF, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0xFF, 0xFF
        db 0xFF, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0xFF, 0xFF
        db 0xFF, 0x0A, 0x0A, 0xFF, 0x0A, 0x0A, 0xFF, 0xFF, 0x0A, 0x0A, 0x0A, 0xFF, 0x0A, 0x0A, 0xFF, 0xFF
        db 0xFF, 0x0A, 0xFF, 0xFF, 0xFF, 0x0A, 0xFF, 0xFF, 0x0A, 0x0A, 0xFF, 0xFF, 0xFF, 0x0A, 0xFF, 0xFF

sprite2 db 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF
        db 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF
        db 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF
        db 0xFF, 0xFF, 0xFF, 0xFF, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF
        db 0xFF, 0xFF, 0xFF, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0xFF, 0xFF, 0xFF, 0xFF
        db 0xFF, 0xFF, 0x0A, 0x0A, 0x0A, 0x0f, 0x0f, 0x0A, 0x0A, 0x0A, 0x0f, 0x0f, 0x0A, 0xFF, 0xFF, 0xFF
        db 0xFF, 0xFF, 0x0A, 0x0A, 0x0f, 0x0f, 0x00, 0x00, 0x0A, 0x0f, 0x0f, 0x00, 0x00, 0xFF, 0xFF, 0xFF
        db 0xFF, 0xFF, 0x0A, 0x0A, 0x0f, 0x0f, 0x00, 0x00, 0x0A, 0x0f, 0x0f, 0x00, 0x00, 0xFF, 0xFF, 0xFF
        db 0xFF, 0x0A, 0x0A, 0x0A, 0x0f, 0x0f, 0x0f, 0x0f, 0x0A, 0x0f, 0x0f, 0x0f, 0x0f, 0x0A, 0xFF, 0xFF
        db 0xFF, 0x0A, 0x0A, 0x0A, 0x0A, 0x0f, 0x0f, 0x0A, 0x0A, 0x0A, 0x0f, 0x0f, 0x0A, 0x0A, 0xFF, 0xFF
        db 0xFF, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0xFF, 0xFF
        db 0xFF, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0xFF, 0xFF
        db 0xFF, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0xFF, 0xFF
        db 0xFF, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0xFF, 0xFF
        db 0xFF, 0x0A, 0x0A, 0xFF, 0x0A, 0x0A, 0xFF, 0xFF, 0x0A, 0x0A, 0x0A, 0xFF, 0x0A, 0x0A, 0xFF, 0xFF
        db 0xFF, 0x0A, 0xFF, 0xFF, 0xFF, 0x0A, 0xFF, 0xFF, 0x0A, 0x0A, 0xFF, 0xFF, 0xFF, 0x0A, 0xFF, 0xFF

sprite3 db 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF
        db 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF
        db 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF
        db 0xFF, 0xFF, 0xFF, 0xFF, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF
        db 0xFF, 0xFF, 0xFF, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0xFF, 0xFF, 0xFF, 0xFF
        db 0xFF, 0xFF, 0x0A, 0x0A, 0x0A, 0x0f, 0x0f, 0x0A, 0x0A, 0x0A, 0x0f, 0x0f, 0x0A, 0xFF, 0xFF, 0xFF
        db 0xFF, 0xFF, 0x0A, 0x0A, 0x0f, 0x0f, 0x00, 0x00, 0x0A, 0x0f, 0x0f, 0x00, 0x00, 0xFF, 0xFF, 0xFF
        db 0xFF, 0xFF, 0x0A, 0x0A, 0x0f, 0x0f, 0x00, 0x00, 0x0A, 0x0f, 0x0f, 0x00, 0x00, 0xFF, 0xFF, 0xFF
        db 0xFF, 0x0A, 0x0A, 0x0A, 0x0f, 0x0f, 0x0f, 0x0f, 0x0A, 0x0f, 0x0f, 0x0f, 0x0f, 0x0A, 0xFF, 0xFF
        db 0xFF, 0x0A, 0x0A, 0x0A, 0x0A, 0x0f, 0x0f, 0x0A, 0x0A, 0x0A, 0x0f, 0x0f, 0x0A, 0x0A, 0xFF, 0xFF
        db 0xFF, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0xFF, 0xFF
        db 0xFF, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0xFF, 0xFF
        db 0xFF, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0xFF, 0xFF
        db 0xFF, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0xFF, 0xFF
        db 0xFF, 0x0A, 0x0A, 0xFF, 0x0A, 0x0A, 0xFF, 0xFF, 0x0A, 0x0A, 0x0A, 0xFF, 0x0A, 0x0A, 0xFF, 0xFF
        db 0xFF, 0x0A, 0xFF, 0xFF, 0xFF, 0x0A, 0xFF, 0xFF, 0x0A, 0x0A, 0xFF, 0xFF, 0xFF, 0x0A, 0xFF, 0xFF

sprite4 db 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF
        db 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF
        db 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF
        db 0xFF, 0xFF, 0xFF, 0xFF, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF
        db 0xFF, 0xFF, 0xFF, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0xFF, 0xFF, 0xFF, 0xFF
        db 0xFF, 0xFF, 0x0A, 0x0A, 0x0A, 0x0f, 0x0f, 0x0A, 0x0A, 0x0A, 0x0f, 0x0f, 0x0A, 0xFF, 0xFF, 0xFF
        db 0xFF, 0xFF, 0x0A, 0x0A, 0x0f, 0x0f, 0x00, 0x00, 0x0A, 0x0f, 0x0f, 0x00, 0x00, 0xFF, 0xFF, 0xFF
        db 0xFF, 0xFF, 0x0A, 0x0A, 0x0f, 0x0f, 0x00, 0x00, 0x0A, 0x0f, 0x0f, 0x00, 0x00, 0xFF, 0xFF, 0xFF
        db 0xFF, 0x0A, 0x0A, 0x0A, 0x0f, 0x0f, 0x0f, 0x0f, 0x0A, 0x0f, 0x0f, 0x0f, 0x0f, 0x0A, 0xFF, 0xFF
        db 0xFF, 0x0A, 0x0A, 0x0A, 0x0A, 0x0f, 0x0f, 0x0A, 0x0A, 0x0A, 0x0f, 0x0f, 0x0A, 0x0A, 0xFF, 0xFF
        db 0xFF, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0xFF, 0xFF
        db 0xFF, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0xFF, 0xFF
        db 0xFF, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0xFF, 0xFF
        db 0xFF, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0xFF, 0xFF
        db 0xFF, 0x0A, 0x0A, 0xFF, 0x0A, 0x0A, 0xFF, 0xFF, 0x0A, 0x0A, 0x0A, 0xFF, 0x0A, 0x0A, 0xFF, 0xFF
        db 0xFF, 0x0A, 0xFF, 0xFF, 0xFF, 0x0A, 0xFF, 0xFF, 0x0A, 0x0A, 0xFF, 0xFF, 0xFF, 0x0A, 0xFF, 0xFF


    Pacman db 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF
           db 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF
           db 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x2C, 0x2C, 0x2C, 0x2C, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF
           db 0xFF, 0xFF, 0xFF, 0xFF, 0x2C, 0x2C, 0x2C, 0x2C, 0x2C, 0x2C, 0x2C, 0x2C, 0xFF, 0xFF, 0xFF, 0xFF
           db 0xFF, 0xFF, 0xFF, 0xFF, 0x2C, 0x2C, 0x2C, 0x2C, 0x2C, 0x2C, 0x2C, 0x2C, 0xFF, 0xFF, 0xFF, 0xFF
           db 0xFF, 0xFF, 0xFF, 0x2C, 0x2C, 0x2C, 0x2C, 0x2C, 0x2C, 0x2C, 0x2C, 0x2C, 0x2C, 0xFF, 0xFF, 0xFF
           db 0xFF, 0xFF, 0xFF, 0x2C, 0x2C, 0x2C, 0x2C, 0x2C, 0x2C, 0x2C, 0x2C, 0x2C, 0x2C, 0xFF, 0xFF, 0xFF
           db 0xFF, 0xFF, 0x2C, 0x2C, 0x2C, 0x2C, 0x2C, 0x2C, 0x2C, 0x2C, 0x2C, 0x2C, 0x2C, 0x2C, 0xFF, 0xFF
           db 0xFF, 0xFF, 0x2C, 0x2C, 0x2C, 0x2C, 0x2C, 0x2C, 0x2C, 0x2C, 0x2C, 0x2C, 0x2C, 0x2C, 0xFF, 0xFF
           db 0xFF, 0xFF, 0x2C, 0x2C, 0x2C, 0x2C, 0x2C, 0x2C, 0x2C, 0x2C, 0x2C, 0x2C, 0x2C, 0x2C, 0xFF, 0xFF
           db 0xFF, 0xFF, 0xFF, 0x2C, 0x2C, 0x2C, 0x2C, 0x2C, 0x2C, 0x2C, 0x2C, 0x2C, 0x2C, 0xFF, 0xFF, 0xFF
           db 0xFF, 0xFF, 0xFF, 0x2C, 0x2C, 0x2C, 0x2C, 0x2C, 0x2C, 0x2C, 0x2C, 0x2C, 0x2C, 0xFF, 0xFF, 0xFF
           db 0xFF, 0xFF, 0xFF, 0xFF, 0x2C, 0x2C, 0x2C, 0x2C, 0x2C, 0x2C, 0x2C, 0x2C, 0xFF, 0xFF, 0xFF, 0xFF
           db 0xFF, 0xFF, 0xFF, 0xFF, 0x2C, 0x2C, 0x2C, 0x2C, 0x2C, 0x2C, 0x2C, 0x2C, 0xFF, 0xFF, 0xFF, 0xFF
           db 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x2C, 0x2C, 0x2C, 0x2C, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF
           db 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF
        

maze db 0x00, 0x00, 0x54, 0x54, 0x54, 0x54, 0x00, 0x00, 0x00, 0x00, 0x54, 0x54, 0x54, 0x54, 0x00, 0x00
     db 0x00, 0x54, 0x54, 0x54, 0x54, 0x54, 0x54, 0x00, 0x00, 0x00, 0x54, 0x54, 0x54, 0x54, 0x00, 0x00
     db 0x54, 0x54, 0x0F, 0x0F, 0x54, 0x0F, 0x0F, 0x54, 0x00, 0x00, 0x54, 0x54, 0x54, 0x54, 0x00, 0x00
     db 0x54, 0x54, 0x0F, 0x21, 0x54, 0x0F, 0x21, 0x54, 0x00, 0x00, 0x54, 0x54, 0x54, 0x54, 0x00, 0x00
     db 0x54, 0x54, 0x0F, 0x0F, 0x54, 0x0F, 0x0F, 0x54, 0x00, 0x00, 0x54, 0x54, 0x54, 0x54, 0x00, 0x00
     db 0x54, 0x54, 0x54, 0x54, 0x54, 0x54, 0x54, 0x54, 0x00, 0x00, 0x54, 0x54, 0x54, 0x54, 0x00, 0x00
     db 0x54, 0x54, 0x54, 0x54, 0x54, 0x54, 0x54, 0x54, 0x00, 0x00, 0x54, 0x54, 0x54, 0x54, 0x00, 0x00
     db 0x00, 0x54, 0x54, 0x00, 0x54, 0x54, 0x00, 0x54, 0x00, 0x00, 0x54, 0x54, 0x54, 0x54, 0x00, 0x00
     db 0x00, 0x00, 0x54, 0x54, 0x54, 0x54, 0x00, 0x00, 0x00, 0x00, 0x54, 0x54, 0x54, 0x54, 0x00, 0x00
     db 0x00, 0x54, 0x54, 0x54, 0x54, 0x54, 0x54, 0x00, 0x00, 0x00, 0x54, 0x54, 0x54, 0x54, 0x00, 0x00
     db 0x54, 0x54, 0x0F, 0x0F, 0x54, 0x0F, 0x0F, 0x54, 0x00, 0x00, 0x54, 0x54, 0x54, 0x54, 0x00, 0x00
     db 0x54, 0x54, 0x0F, 0x21, 0x54, 0x0F, 0x21, 0x54, 0x00, 0x00, 0x54, 0x54, 0x54, 0x54, 0x00, 0x00
     db 0x54, 0x54, 0x0F, 0x0F, 0x54, 0x0F, 0x0F, 0x54, 0x00, 0x00, 0x54, 0x54, 0x54, 0x54, 0x00, 0x00
     db 0x54, 0x54, 0x54, 0x54, 0x54, 0x54, 0x54, 0x54, 0x00, 0x00, 0x54, 0x54, 0x54, 0x54, 0x00, 0x00
     db 0x54, 0x54, 0x54, 0x54, 0x54, 0x54, 0x54, 0x54, 0x00, 0x00, 0x54, 0x54, 0x54, 0x54, 0x00, 0x00
     db 0x00, 0x54, 0x54, 0x00, 0x54, 0x54, 0x00, 0x54, 0x00, 0x00, 0x54, 0x54, 0x54, 0x54, 0x00, 0x00

;[0, 40, 65, 84, 0, 52, 78, 66, 0, 44, 0, 33, 48, 3, 88, 15]

section .text

call heap_init
mov ax, 1000h
call heap_allocate
mov [backBufferSeg], ax

mov ax, 0013h      ; Set Video Mode 4F02h (VBE mode 101h) - 640x480, 256 colors
;mov bx, 101h    ; VBE mode 101h
int 10h

GameLoop:

mov al, 0FFh
call clearScreen
;call printMaze
mov di, [xPos]
mov si, sprite
call printGhost
call presentBackBuffer
mov bx, [xPos]
add bx, [xVelocity]
mov word [xPos], bx
; cmp
; je Exit
mov cx, 10000
WaitLoop:
loop WaitLoop
cmp word [xPos], 320-16
je ChangeVelocity
cmp word [xPos], 0
je ChangeVelocity
jmp GameLoop


; mov di, 12
; mov si, sprite2
; call printGhost

; mov di, 24
; mov si, sprite3
; call printGhost

; mov di, 36
; mov si, sprite4
; call printGhost


;reset the keyboard buffer and then wait for a keypress :

Exit:
mov ax, 0C01h ; 
int 21h

;dos box default video mode
mov ax, 03h 
int 21h

int 20h ;quit





the_functions:

; need to set the color of filling in al
clearScreen:
mov ax, [cs:backBufferSeg]
mov es, ax
mov di, 0
mov cx, 320*200
rep stosb
ret 

presentBackBuffer:
push ds
push es
mov ax, [cs:backBufferSeg]
mov ds, ax
mov ax, 0A000h
mov es, ax
xor si, si
xor di, di
mov cx, 320*200
rep movsb
pop es
pop ds
ret


printMaze:
mov ax, 0xA000
mov es, ax
mov di, 48
mov si, maze
mov dx, 16
loopy5:
    mov cx, 16
    rep movsb
    add di, 640-16
    dec dx
    jnz loopy5
ret

printGhost:
mov ax, [cs:backBufferSeg]
mov es, ax
mov dx, 16

printplayer:
    mov ah, 09h ; DOS function to print a string
    mov bx, Pacman ; Offset of the string to print


loopyy:
    mov cx, 16
    rep movsb
    add di, 320-16
    dec dx
    jnz loopyy
ret

ChangeVelocity:
neg word [xVelocity]
jmp GameLoop

%include "seg.inc"